"use strict";(self.webpackChunk_pamfilico_feedback=self.webpackChunk_pamfilico_feedback||[]).push([[951],{"./src/material/MaterialFeedbackButton.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>MaterialFeedbackButton_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),dynamic=__webpack_require__("./node_modules/next/dynamic.js"),dynamic_default=__webpack_require__.n(dynamic),Dialog=__webpack_require__("./node_modules/@mui/material/esm/Dialog/Dialog.js"),DialogContent=__webpack_require__("./node_modules/@mui/material/esm/DialogContent/DialogContent.js"),Drawer=__webpack_require__("./node_modules/@mui/material/esm/Drawer/Drawer.js"),IconButton=__webpack_require__("./node_modules/@mui/material/esm/IconButton/IconButton.js"),Box=__webpack_require__("./node_modules/@mui/material/esm/Box/Box.js"),Typography=__webpack_require__("./node_modules/@mui/material/esm/Typography/Typography.js"),Button=__webpack_require__("./node_modules/@mui/material/esm/Button/Button.js"),FormControl=__webpack_require__("./node_modules/@mui/material/esm/FormControl/FormControl.js"),InputLabel=__webpack_require__("./node_modules/@mui/material/esm/InputLabel/InputLabel.js"),Select=__webpack_require__("./node_modules/@mui/material/esm/Select/Select.js"),MenuItem=__webpack_require__("./node_modules/@mui/material/esm/MenuItem/MenuItem.js"),TextField=__webpack_require__("./node_modules/@mui/material/esm/TextField/TextField.js"),useTheme=__webpack_require__("./node_modules/@mui/material/esm/styles/useTheme.js"),useMediaQuery=__webpack_require__("./node_modules/@mui/material/esm/useMediaQuery/index.js"),Chip=__webpack_require__("./node_modules/@mui/material/esm/Chip/Chip.js"),Fab=__webpack_require__("./node_modules/@mui/material/esm/Fab/Fab.js"),Feedback=__webpack_require__("./node_modules/@mui/icons-material/esm/Feedback.js"),ArrowBack=__webpack_require__("./node_modules/@mui/icons-material/esm/ArrowBack.js"),Save=__webpack_require__("./node_modules/@mui/icons-material/esm/Save.js"),PhoneAndroid=__webpack_require__("./node_modules/@mui/icons-material/esm/PhoneAndroid.js"),Computer=__webpack_require__("./node_modules/@mui/icons-material/esm/Computer.js"),Tablet=__webpack_require__("./node_modules/@mui/icons-material/esm/Tablet.js"),formik_esm=__webpack_require__("./node_modules/formik/dist/formik.esm.js"),index_esm=__webpack_require__("./node_modules/yup/index.esm.js"),dist=__webpack_require__("./node_modules/react-hot-toast/dist/index.mjs"),console=__webpack_require__("./node_modules/console-browserify/index.js");const CanvasDraw=dynamic_default()(()=>__webpack_require__.e(716).then(__webpack_require__.bind(__webpack_require__,"./node_modules/react-canvas-draw/es/index.js")),{loadableGenerated:{webpack:()=>["./node_modules/react-canvas-draw/es/index.js"]},ssr:!1,loading:()=>(0,jsx_runtime.jsx)("div",{children:"Loading canvas..."})}),validationSchema=index_esm.Ik({feedbackType:index_esm.Yj().required("Feedback type is required"),description:index_esm.Yj().min(10,"Description should be at least 10 characters long").required("Description is required")});function MaterialFeedbackButton({userEmail=null,apiBasePath="/api/feedback",additionalHeaders={},hideIfNoEmail=!1,appId}){const[image,setImage]=(0,react.useState)(""),[dialogOpen,setDialogOpen]=(0,react.useState)(!1),[drawerOpen,setDrawerOpen]=(0,react.useState)(!1),[isClient,setIsClient]=(0,react.useState)(!1),canvasRef=(0,react.useRef)(null),theme=(0,useTheme.A)(),isMobile=(0,useMediaQuery.A)(theme.breakpoints.down("sm")),isTablet=(0,useMediaQuery.A)(theme.breakpoints.between("sm","md")),isDesktop=(0,useMediaQuery.A)(theme.breakpoints.up("md")),getScreenSize=()=>isMobile?"mobile":isTablet?"tablet":isDesktop?"desktop":"unknown";if((0,react.useEffect)(()=>{setIsClient(!0)},[]),hideIfNoEmail&&!userEmail)return null;const handleClose=(0,react.useCallback)(()=>{console.log("[MaterialFeedbackButton] handleClose called"),setDialogOpen(!1),setDrawerOpen(!1),formik.resetForm()},[]),handleUploadImage=(0,react.useCallback)(file=>{const reader=new FileReader;reader.onload=e=>{var _e_target;const result=null===(_e_target=e.target)||void 0===_e_target?void 0:_e_target.result;"string"==typeof result&&(setImage(result),dist.Ay.success("Screenshot uploaded successfully"))},reader.onerror=()=>{dist.Ay.error("Failed to upload screenshot")},reader.readAsDataURL(file)},[]),clearDrawing=(0,react.useCallback)(()=>{canvasRef.current&&canvasRef.current.clear()},[]),undoLastDrawing=(0,react.useCallback)(()=>{canvasRef.current&&canvasRef.current.undo()},[]),formik=(0,formik_esm.Wx)({initialValues:{feedbackType:"",description:""},validationSchema,onSubmit:async values=>{console.log("[MaterialFeedbackButton] Form submit started",values);try{const currentUrl=window.location.href;let drawings=null;if(canvasRef.current){const drawingsData=canvasRef.current.getSaveData();drawings=drawingsData?JSON.parse(drawingsData):null}const payload={feedbackType:values.feedbackType,description:values.description,image,current_url:currentUrl,drawings,user_email:userEmail,material_ui_screensize:getScreenSize(),app_id:appId};console.log("[MaterialFeedbackButton] Submitting feedback to:",apiBasePath);const response=await fetch(apiBasePath,{method:"POST",headers:{"Content-Type":"application/json",...additionalHeaders},body:JSON.stringify(payload)});if(!response.ok){const errorData=await response.json().catch(()=>({}));throw new Error(errorData.error||"Failed to submit feedback")}console.log("[MaterialFeedbackButton] Feedback submitted successfully"),dist.Ay.success("Feedback submitted successfully!"),formik.resetForm(),console.log("[MaterialFeedbackButton] Closing dialog after submit"),setDialogOpen(!1),setImage("")}catch(error){console.error("[MaterialFeedbackButton] Error submitting feedback:",error),dist.Ay.error(error instanceof Error?error.message:"Failed to submit feedback. Please try again.")}}});return isClient?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(Button.A,{sx:{position:"fixed",bottom:20,right:20,backgroundColor:"white",padding:"10px 20px",zIndex:1e3},color:"error",onClick:async()=>{console.log("[MaterialFeedbackButton] captureScreenshot called");try{console.log("[MaterialFeedbackButton] Starting screenshot capture");const{toPng}=await __webpack_require__.e(777).then(__webpack_require__.bind(__webpack_require__,"./node_modules/html-to-image/es/index.js")),screenshot=await toPng(document.body,{cacheBust:!0,pixelRatio:1,skipFonts:!0,skipAutoScale:!0,filter:node=>{var _node_classList,_node_src;return!(null===(_node_classList=node.classList)||void 0===_node_classList?void 0:_node_classList.contains("ProseMirror-separator"))&&("IMG"!==node.tagName||!(null===(_node_src=node.src)||void 0===_node_src?void 0:_node_src.includes("data:")))}});console.log("[MaterialFeedbackButton] Screenshot captured successfully, length:",screenshot.length),setImage(screenshot),console.log("[MaterialFeedbackButton] Setting dialogOpen to true"),setDialogOpen(!0)}catch(error){console.error("[MaterialFeedbackButton] Failed to take screenshot:",error),setImage(""),console.log("[MaterialFeedbackButton] Setting dialogOpen to true (fallback)"),setDialogOpen(!0),setDrawerOpen(!0),dist.Ay.error("Failed to capture screenshot")}},children:["Feedback",(0,jsx_runtime.jsx)(Feedback.A,{sx:{marginLeft:1}})]}),(0,jsx_runtime.jsxs)(Dialog.A,{open:dialogOpen,onClose:handleClose,fullScreen:!0,onTransitionEnter:()=>console.log("[MaterialFeedbackButton] Dialog transition enter"),onTransitionExited:()=>console.log("[MaterialFeedbackButton] Dialog transition exited"),children:[(0,jsx_runtime.jsxs)(Box.A,{sx:{m:0,p:2,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid rgba(0, 0, 0, 0.12)"},children:[(0,jsx_runtime.jsx)(IconButton.A,{"aria-label":"back",onClick:handleClose,sx:{color:theme=>theme.palette.grey[500]},children:(0,jsx_runtime.jsx)(ArrowBack.A,{})}),(0,jsx_runtime.jsxs)(Box.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,jsx_runtime.jsx)(Chip.A,{icon:"mobile"===getScreenSize()?(0,jsx_runtime.jsx)(PhoneAndroid.A,{}):"tablet"===getScreenSize()?(0,jsx_runtime.jsx)(Tablet.A,{}):(0,jsx_runtime.jsx)(Computer.A,{}),label:getScreenSize().toUpperCase(),color:"mobile"===getScreenSize()?"success":"tablet"===getScreenSize()?"warning":"primary",size:"small"}),(0,jsx_runtime.jsx)(Box.A,{component:"span",sx:{fontSize:"1.25rem",fontWeight:500,color:"text.secondary",fontStyle:"italic"},children:"ðŸ’¡ You can draw on the screenshot"})]}),(0,jsx_runtime.jsx)(Fab.A,{color:"primary","aria-label":"save feedback",onClick:()=>{console.log("[MaterialFeedbackButton] Save FAB clicked, opening drawer"),setDrawerOpen(!0)},size:"medium",sx:{animation:"wiggle 2s ease-in-out infinite","@keyframes wiggle":{"0%, 100%":{transform:"rotate(0deg)"},"25%":{transform:"rotate(-5deg)"},"75%":{transform:"rotate(5deg)"}}},children:(0,jsx_runtime.jsx)(Save.A,{})})]}),(0,jsx_runtime.jsxs)(DialogContent.A,{sx:{p:0,height:"calc(100vh - 64px)",overflow:"hidden",position:"relative"},children:[(0,jsx_runtime.jsx)(Drawer.Ay,{anchor:"right",open:drawerOpen,onClose:()=>{console.log("[MaterialFeedbackButton] Drawer close triggered"),setDrawerOpen(!1)},variant:"temporary",ModalProps:{keepMounted:!0,container:()=>document.querySelector('[role="dialog"]')},sx:{"& .MuiDrawer-paper":{width:400,position:"absolute",height:"100%",boxSizing:"border-box"}},children:(0,jsx_runtime.jsxs)(Box.A,{sx:{height:"100%",bgcolor:"background.paper",overflowY:"auto",p:3},children:[(0,jsx_runtime.jsx)(Button.A,{variant:"contained",color:"secondary",onClick:clearDrawing,fullWidth:!0,sx:{mb:2},children:"Reset Drawing"}),(0,jsx_runtime.jsx)(Button.A,{variant:"contained",color:"primary",onClick:undoLastDrawing,fullWidth:!0,sx:{mb:2},children:"Undo"}),(0,jsx_runtime.jsx)(Button.A,{variant:"outlined",color:"primary",onClick:()=>setDrawerOpen(!1),fullWidth:!0,sx:{mb:3},children:"Close Form"}),(0,jsx_runtime.jsxs)("form",{onSubmit:formik.handleSubmit,children:[(0,jsx_runtime.jsxs)(FormControl.A,{fullWidth:!0,margin:"normal",children:[(0,jsx_runtime.jsx)(InputLabel.A,{id:"feedbackType-label",children:"Feedback Type"}),(0,jsx_runtime.jsxs)(Select.A,{labelId:"feedbackType-label",id:"feedbackType",name:"feedbackType",value:formik.values.feedbackType,onChange:formik.handleChange,error:formik.touched.feedbackType&&Boolean(formik.errors.feedbackType),label:"Feedback Type",children:[(0,jsx_runtime.jsx)(MenuItem.A,{value:"bug",children:"Bug"}),(0,jsx_runtime.jsx)(MenuItem.A,{value:"feature",children:"Feature Request"}),(0,jsx_runtime.jsx)(MenuItem.A,{value:"other",children:"Other"})]}),formik.touched.feedbackType&&formik.errors.feedbackType&&(0,jsx_runtime.jsx)(Box.A,{sx:{color:"error.main",fontSize:"0.75rem",mt:.5},children:formik.errors.feedbackType})]}),(0,jsx_runtime.jsx)(TextField.A,{fullWidth:!0,margin:"normal",id:"description",name:"description",label:"Description",multiline:!0,rows:8,value:formik.values.description,onChange:formik.handleChange,error:formik.touched.description&&Boolean(formik.errors.description),helperText:formik.touched.description&&formik.errors.description}),(0,jsx_runtime.jsx)(Button.A,{color:"primary",variant:"contained",fullWidth:!0,type:"submit",sx:{mt:2},children:"Submit Feedback"})]})]})}),(0,jsx_runtime.jsx)(Box.A,{sx:{width:"100%",height:"100%",position:"relative",bgcolor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center"},children:image?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("img",{src:image,alt:"Screenshot",style:{width:"100%",height:"100%",objectFit:"contain",display:"block",position:"relative",zIndex:1}}),(0,jsx_runtime.jsx)(Box.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",zIndex:2},children:(0,jsx_runtime.jsx)(Box.A,{sx:{position:"relative",width:Math.floor(window.innerWidth),height:Math.floor(.9*window.innerHeight),pointerEvents:"auto"},children:(0,jsx_runtime.jsx)(CanvasDraw,{ref:canvasRef,canvasWidth:Math.floor(window.innerWidth),canvasHeight:Math.floor(.9*window.innerHeight),brushColor:"#ff0000",brushRadius:3,lazyRadius:0,hideGrid:!0,backgroundColor:"transparent"})})})]}):(0,jsx_runtime.jsxs)(Box.A,{sx:{textAlign:"center",px:4},children:[(0,jsx_runtime.jsx)(Typography.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Failed to capture screenshot"}),(0,jsx_runtime.jsx)(Typography.A,{variant:"body2",color:"text.secondary",sx:{mt:2,mb:3},children:"Exit this screen, take a manual screenshot, and upload it by clicking the button below."}),(0,jsx_runtime.jsxs)(Button.A,{variant:"contained",component:"label",sx:{mt:2},children:["Upload Screenshot",(0,jsx_runtime.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:e=>{var _e_target_files;const file=null===(_e_target_files=e.target.files)||void 0===_e_target_files?void 0:_e_target_files[0];file&&handleUploadImage(file)}})]})]})})]})]})]}):null}MaterialFeedbackButton.__docgenInfo={description:"",methods:[],displayName:"MaterialFeedbackButton",props:{userEmail:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:"",defaultValue:{value:"null",computed:!1}},apiBasePath:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'"/api/feedback"',computed:!1}},additionalHeaders:{required:!1,tsType:{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"},description:"",defaultValue:{value:"{}",computed:!1}},hideIfNoEmail:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},appId:{required:!1,tsType:{name:"string"},description:""}}};const MaterialFeedbackButton_stories={title:"Material/MaterialFeedbackButton",component:MaterialFeedbackButton,parameters:{layout:"fullscreen",msw:{handlers:__webpack_require__("./src/mocks/handlers.ts").Y}},tags:["autodocs"],argTypes:{userEmail:{control:"text",description:"User email for feedback submission"},apiBasePath:{control:"text",description:"Backend API base path for feedback endpoints"},additionalHeaders:{control:"object",description:"Additional headers for API requests"},hideIfNoEmail:{control:"boolean",description:"Hide button if no user email provided"},appId:{control:"text",description:"Application ID for tracking"}}},Default={args:{userEmail:"user@example.com",apiBasePath:"/api/v1/feedback",additionalHeaders:{},hideIfNoEmail:!1}},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{\n  args: {\n    userEmail: 'user@example.com',\n    apiBasePath: '/api/v1/feedback',\n    additionalHeaders: {},\n    hideIfNoEmail: false\n  }\n}",...Default.parameters?.docs?.source},description:{story:"Simple feedback button that appears fixed in the bottom right corner.\nClick to capture screenshot, draw annotations, and submit feedback.",...Default.parameters?.docs?.description}}}}}]);