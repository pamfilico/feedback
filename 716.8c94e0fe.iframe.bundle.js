"use strict";(self.webpackChunk_pamfilico_feedback=self.webpackChunk_pamfilico_feedback||[]).push([[716],{"./node_modules/catenary-curve/lib/Catenary.js":(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Point2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__("./node_modules/catenary-curve/lib/Point.js"));var Catenary=function(){function Catenary(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_ref$segments=_ref.segments,segments=void 0===_ref$segments?50:_ref$segments,_ref$iterationLimit=_ref.iterationLimit,iterationLimit=void 0===_ref$iterationLimit?100:_ref$iterationLimit;!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Catenary),this.p1=new _Point2.default,this.p2=new _Point2.default,this.segments=segments,this.iterationLimit=iterationLimit}return _createClass(Catenary,[{key:"drawToCanvas",value:function drawToCanvas(context,point1,point2,chainLength){this.p1.update(point1),this.p2.update(point2);var isFlipped=this.p1.x>this.p2.x,p1=isFlipped?this.p2:this.p1,p2=isFlipped?this.p1:this.p2,curveData=[],isStraight=!0;if(p1.getDistanceTo(p2)<chainLength)if(p2.x-p1.x>.01){var h=p2.x-p1.x,v=p2.y-p1.y,a=-this.getCatenaryParameter(h,v,chainLength,this.iterationLimit),x=.5*(a*Math.log((chainLength+v)/(chainLength-v))-h),y=a*Math.cosh(x/a),offsetX=p1.x-x,offsetY=p1.y-y;curveData=this.getCurve(a,p1,p2,offsetX,offsetY,this.segments),isStraight=!1}else{var mx=.5*(p1.x+p2.x),my=.5*(p1.y+p2.y+chainLength);curveData=[[p1.x,p1.y],[mx,my],[p2.x,p2.y]]}else curveData=[[p1.x,p1.y],[p2.x,p2.y]];return isStraight?this.drawLine(curveData,context):this.drawCurve(curveData,context),curveData}},{key:"getCatenaryParameter",value:function getCatenaryParameter(h,v,length,limit){for(var m=Math.sqrt(length*length-v*v)/h,x=Math.acosh(m)+1,prevx=-1,count=0;Math.abs(x-prevx)>1e-6&&count<limit;)prevx=x,x-=(Math.sinh(x)-m*x)/(Math.cosh(x)-m),count++;return h/(2*x)}},{key:"getCurve",value:function getCurve(a,p1,p2,offsetX,offsetY,segments){for(var data=[p1.x,a*Math.cosh((p1.x-offsetX)/a)+offsetY],d=p2.x-p1.x,length=segments-1,i=0;i<length;i++){var x=p1.x+d*(i+.5)/length,y=a*Math.cosh((x-offsetX)/a)+offsetY;data.push(x,y)}return data.push(p2.x,a*Math.cosh((p2.x-offsetX)/a)+offsetY),data}},{key:"drawLine",value:function drawLine(data,context){context.moveTo(data[0][0],data[0][1]),context.lineTo(data[1][0],data[1][1])}},{key:"drawCurve",value:function drawCurve(data,context){var length=.5*data.length-1,ox=data[2],oy=data[3],temp=[];context.moveTo(data[0],data[1]);for(var i=2;i<length;i++){var x=data[2*i],y=data[2*i+1],mx=.5*(x+ox),my=.5*(y+oy);temp.push([ox,oy,mx,my]),context.quadraticCurveTo(ox,oy,mx,my),ox=x,oy=y}return length=data.length,context.quadraticCurveTo(data[length-4],data[length-3],data[length-2],data[length-1]),temp}}]),Catenary}();exports.default=Catenary},"./node_modules/catenary-curve/lib/Point.js":(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var Point=function(){function Point(x,y){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Point),this.x=x,this.y=y}return _createClass(Point,[{key:"update",value:function update(point){this.x=point.x,this.y=point.y}},{key:"getDifferenceTo",value:function getDifferenceTo(point){return new Point(this.x-point.x,this.y-point.y)}},{key:"getDistanceTo",value:function getDistanceTo(point){var diff=this.getDifferenceTo(point);return Math.sqrt(Math.pow(diff.x,2)+Math.pow(diff.y,2))}}]),Point}();exports.default=Point},"./node_modules/catenary-curve/lib/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{exports.Op=void 0;var _Catenary2=_interopRequireDefault(__webpack_require__("./node_modules/catenary-curve/lib/Catenary.js")),_Point2=_interopRequireDefault(__webpack_require__("./node_modules/catenary-curve/lib/Point.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.Op=_Catenary2.default,_Point2.default},"./node_modules/lazy-brush/lib/LazyBrush.js":(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_LazyPoint2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__("./node_modules/lazy-brush/lib/LazyPoint.js"));var LazyBrush=function(){function LazyBrush(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_ref$radius=_ref.radius,radius=void 0===_ref$radius?30:_ref$radius,_ref$enabled=_ref.enabled,enabled=void 0===_ref$enabled||_ref$enabled,_ref$initialPoint=_ref.initialPoint,initialPoint=void 0===_ref$initialPoint?{x:0,y:0}:_ref$initialPoint;!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,LazyBrush),this.radius=radius,this._isEnabled=enabled,this.pointer=new _LazyPoint2.default(initialPoint.x,initialPoint.y),this.brush=new _LazyPoint2.default(initialPoint.x,initialPoint.y),this.angle=0,this.distance=0,this._hasMoved=!1}return _createClass(LazyBrush,[{key:"enable",value:function enable(){this._isEnabled=!0}},{key:"disable",value:function disable(){this._isEnabled=!1}},{key:"isEnabled",value:function isEnabled(){return this._isEnabled}},{key:"setRadius",value:function setRadius(radius){this.radius=radius}},{key:"getRadius",value:function getRadius(){return this.radius}},{key:"getBrushCoordinates",value:function getBrushCoordinates(){return this.brush.toObject()}},{key:"getPointerCoordinates",value:function getPointerCoordinates(){return this.pointer.toObject()}},{key:"getBrush",value:function getBrush(){return this.brush}},{key:"getPointer",value:function getPointer(){return this.pointer}},{key:"getAngle",value:function getAngle(){return this.angle}},{key:"getDistance",value:function getDistance(){return this.distance}},{key:"brushHasMoved",value:function brushHasMoved(){return this._hasMoved}},{key:"update",value:function update(newPointerPoint){var _ref2$both=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).both,both=void 0!==_ref2$both&&_ref2$both;return this._hasMoved=!1,!(this.pointer.equalsTo(newPointerPoint)&&!both)&&(this.pointer.update(newPointerPoint),both?(this._hasMoved=!0,this.brush.update(newPointerPoint),!0):(this._isEnabled?(this.distance=this.pointer.getDistanceTo(this.brush),this.angle=this.pointer.getAngleTo(this.brush),this.distance>this.radius&&(this.brush.moveByAngle(this.angle,this.distance-this.radius),this._hasMoved=!0)):(this.distance=0,this.angle=0,this.brush.update(newPointerPoint),this._hasMoved=!0),!0))}}]),LazyBrush}();exports.default=LazyBrush},"./node_modules/lazy-brush/lib/LazyPoint.js":(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Point3=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__("./node_modules/lazy-brush/lib/Point.js"));var LazyPoint=function(_Point){function LazyPoint(){return function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,LazyPoint),function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,(LazyPoint.__proto__||Object.getPrototypeOf(LazyPoint)).apply(this,arguments))}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(LazyPoint,_Point),_createClass(LazyPoint,[{key:"update",value:function update(point){this.x=point.x,this.y=point.y}},{key:"moveByAngle",value:function moveByAngle(angle,distance){var angleRotated=angle+Math.PI/2;this.x=this.x+Math.sin(angleRotated)*distance,this.y=this.y-Math.cos(angleRotated)*distance}},{key:"equalsTo",value:function equalsTo(point){return this.x===point.x&&this.y===point.y}},{key:"getDifferenceTo",value:function getDifferenceTo(point){return new _Point3.default(this.x-point.x,this.y-point.y)}},{key:"getDistanceTo",value:function getDistanceTo(point){var diff=this.getDifferenceTo(point);return Math.sqrt(Math.pow(diff.x,2)+Math.pow(diff.y,2))}},{key:"getAngleTo",value:function getAngleTo(point){var diff=this.getDifferenceTo(point);return Math.atan2(diff.y,diff.x)}},{key:"toObject",value:function toObject(){return{x:this.x,y:this.y}}}]),LazyPoint}(_Point3.default);exports.default=LazyPoint},"./node_modules/lazy-brush/lib/Point.js":(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function Point(x,y){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Point),this.x=x,this.y=y}},"./node_modules/lazy-brush/lib/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{exports.xi=void 0;var _LazyBrush2=_interopRequireDefault(__webpack_require__("./node_modules/lazy-brush/lib/LazyBrush.js")),_Point2=_interopRequireDefault(__webpack_require__("./node_modules/lazy-brush/lib/Point.js")),_LazyPoint2=_interopRequireDefault(__webpack_require__("./node_modules/lazy-brush/lib/LazyPoint.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.xi=_LazyBrush2.default,_Point2.default,_LazyPoint2.default},"./node_modules/react-canvas-draw/es/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>CanvasDraw});var react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),lib=__webpack_require__("./node_modules/lazy-brush/lib/index.js"),catenary_curve_lib=__webpack_require__("./node_modules/catenary-curve/lib/index.js"),MapShim=function(){if("undefined"!=typeof Map)return Map;function getIndex(arr,key){var result=-1;return arr.some(function(entry,index){return entry[0]===key&&(result=index,!0)}),result}return function(){function class_1(){this.__entries__=[]}return Object.defineProperty(class_1.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),class_1.prototype.get=function(key){var index=getIndex(this.__entries__,key),entry=this.__entries__[index];return entry&&entry[1]},class_1.prototype.set=function(key,value){var index=getIndex(this.__entries__,key);~index?this.__entries__[index][1]=value:this.__entries__.push([key,value])},class_1.prototype.delete=function(key){var entries=this.__entries__,index=getIndex(entries,key);~index&&entries.splice(index,1)},class_1.prototype.has=function(key){return!!~getIndex(this.__entries__,key)},class_1.prototype.clear=function(){this.__entries__.splice(0)},class_1.prototype.forEach=function(callback,ctx){void 0===ctx&&(ctx=null);for(var _i=0,_a=this.__entries__;_i<_a.length;_i++){var entry=_a[_i];callback.call(ctx,entry[1],entry[0])}},class_1}()}(),isBrowser="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,global$1=void 0!==__webpack_require__.g&&__webpack_require__.g.Math===Math?__webpack_require__.g:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),requestAnimationFrame$1="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(global$1):function(callback){return setTimeout(function(){return callback(Date.now())},1e3/60)};var transitionKeys=["top","right","bottom","left","width","height","size","weight"],mutationObserverSupported="undefined"!=typeof MutationObserver,ResizeObserverController=function(){function ResizeObserverController(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function throttle(callback,delay){var leadingCall=!1,trailingCall=!1,lastCallTime=0;function resolvePending(){leadingCall&&(leadingCall=!1,callback()),trailingCall&&proxy()}function timeoutCallback(){requestAnimationFrame$1(resolvePending)}function proxy(){var timeStamp=Date.now();if(leadingCall){if(timeStamp-lastCallTime<2)return;trailingCall=!0}else leadingCall=!0,trailingCall=!1,setTimeout(timeoutCallback,delay);lastCallTime=timeStamp}return proxy}(this.refresh.bind(this),20)}return ResizeObserverController.prototype.addObserver=function(observer){~this.observers_.indexOf(observer)||this.observers_.push(observer),this.connected_||this.connect_()},ResizeObserverController.prototype.removeObserver=function(observer){var observers=this.observers_,index=observers.indexOf(observer);~index&&observers.splice(index,1),!observers.length&&this.connected_&&this.disconnect_()},ResizeObserverController.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},ResizeObserverController.prototype.updateObservers_=function(){var activeObservers=this.observers_.filter(function(observer){return observer.gatherActive(),observer.hasActive()});return activeObservers.forEach(function(observer){return observer.broadcastActive()}),activeObservers.length>0},ResizeObserverController.prototype.connect_=function(){isBrowser&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),mutationObserverSupported?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},ResizeObserverController.prototype.disconnect_=function(){isBrowser&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},ResizeObserverController.prototype.onTransitionEnd_=function(_a){var _b=_a.propertyName,propertyName=void 0===_b?"":_b;transitionKeys.some(function(key){return!!~propertyName.indexOf(key)})&&this.refresh()},ResizeObserverController.getInstance=function(){return this.instance_||(this.instance_=new ResizeObserverController),this.instance_},ResizeObserverController.instance_=null,ResizeObserverController}(),defineConfigurable=function(target,props){for(var _i=0,_a=Object.keys(props);_i<_a.length;_i++){var key=_a[_i];Object.defineProperty(target,key,{value:props[key],enumerable:!1,writable:!1,configurable:!0})}return target},getWindowOf=function(target){return target&&target.ownerDocument&&target.ownerDocument.defaultView||global$1},emptyRect=createRectInit(0,0,0,0);function toFloat(value){return parseFloat(value)||0}function getBordersSize(styles){for(var positions=[],_i=1;_i<arguments.length;_i++)positions[_i-1]=arguments[_i];return positions.reduce(function(size,position){return size+toFloat(styles["border-"+position+"-width"])},0)}function getHTMLElementContentRect(target){var clientWidth=target.clientWidth,clientHeight=target.clientHeight;if(!clientWidth&&!clientHeight)return emptyRect;var styles=getWindowOf(target).getComputedStyle(target),paddings=function getPaddings(styles){for(var paddings={},_i=0,positions_1=["top","right","bottom","left"];_i<positions_1.length;_i++){var position=positions_1[_i],value=styles["padding-"+position];paddings[position]=toFloat(value)}return paddings}(styles),horizPad=paddings.left+paddings.right,vertPad=paddings.top+paddings.bottom,width=toFloat(styles.width),height=toFloat(styles.height);if("border-box"===styles.boxSizing&&(Math.round(width+horizPad)!==clientWidth&&(width-=getBordersSize(styles,"left","right")+horizPad),Math.round(height+vertPad)!==clientHeight&&(height-=getBordersSize(styles,"top","bottom")+vertPad)),!function isDocumentElement(target){return target===getWindowOf(target).document.documentElement}(target)){var vertScrollbar=Math.round(width+horizPad)-clientWidth,horizScrollbar=Math.round(height+vertPad)-clientHeight;1!==Math.abs(vertScrollbar)&&(width-=vertScrollbar),1!==Math.abs(horizScrollbar)&&(height-=horizScrollbar)}return createRectInit(paddings.left,paddings.top,width,height)}var isSVGGraphicsElement="undefined"!=typeof SVGGraphicsElement?function(target){return target instanceof getWindowOf(target).SVGGraphicsElement}:function(target){return target instanceof getWindowOf(target).SVGElement&&"function"==typeof target.getBBox};function getContentRect(target){return isBrowser?isSVGGraphicsElement(target)?function getSVGContentRect(target){var bbox=target.getBBox();return createRectInit(0,0,bbox.width,bbox.height)}(target):getHTMLElementContentRect(target):emptyRect}function createRectInit(x,y,width,height){return{x,y,width,height}}var ResizeObservation=function(){function ResizeObservation(target){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=createRectInit(0,0,0,0),this.target=target}return ResizeObservation.prototype.isActive=function(){var rect=getContentRect(this.target);return this.contentRect_=rect,rect.width!==this.broadcastWidth||rect.height!==this.broadcastHeight},ResizeObservation.prototype.broadcastRect=function(){var rect=this.contentRect_;return this.broadcastWidth=rect.width,this.broadcastHeight=rect.height,rect},ResizeObservation}(),ResizeObserverEntry=function ResizeObserverEntry(target,rectInit){var contentRect=function createReadOnlyRect(_a){var x=_a.x,y=_a.y,width=_a.width,height=_a.height,Constr="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,rect=Object.create(Constr.prototype);return defineConfigurable(rect,{x,y,width,height,top:y,right:x+width,bottom:height+y,left:x}),rect}(rectInit);defineConfigurable(this,{target,contentRect})},ResizeObserverSPI=function(){function ResizeObserverSPI(callback,controller,callbackCtx){if(this.activeObservations_=[],this.observations_=new MapShim,"function"!=typeof callback)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=callback,this.controller_=controller,this.callbackCtx_=callbackCtx}return ResizeObserverSPI.prototype.observe=function(target){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(target instanceof getWindowOf(target).Element))throw new TypeError('parameter 1 is not of type "Element".');var observations=this.observations_;observations.has(target)||(observations.set(target,new ResizeObservation(target)),this.controller_.addObserver(this),this.controller_.refresh())}},ResizeObserverSPI.prototype.unobserve=function(target){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(target instanceof getWindowOf(target).Element))throw new TypeError('parameter 1 is not of type "Element".');var observations=this.observations_;observations.has(target)&&(observations.delete(target),observations.size||this.controller_.removeObserver(this))}},ResizeObserverSPI.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},ResizeObserverSPI.prototype.gatherActive=function(){var _this=this;this.clearActive(),this.observations_.forEach(function(observation){observation.isActive()&&_this.activeObservations_.push(observation)})},ResizeObserverSPI.prototype.broadcastActive=function(){if(this.hasActive()){var ctx=this.callbackCtx_,entries=this.activeObservations_.map(function(observation){return new ResizeObserverEntry(observation.target,observation.broadcastRect())});this.callback_.call(ctx,entries,ctx),this.clearActive()}},ResizeObserverSPI.prototype.clearActive=function(){this.activeObservations_.splice(0)},ResizeObserverSPI.prototype.hasActive=function(){return this.activeObservations_.length>0},ResizeObserverSPI}(),observers="undefined"!=typeof WeakMap?new WeakMap:new MapShim,ResizeObserver=function ResizeObserver(callback){if(!(this instanceof ResizeObserver))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var controller=ResizeObserverController.getInstance(),observer=new ResizeObserverSPI(callback,controller,this);observers.set(this,observer)};["observe","unobserve","disconnect"].forEach(function(method){ResizeObserver.prototype[method]=function(){var _a;return(_a=observers.get(this))[method].apply(_a,arguments)}});const ResizeObserver_es=void 0!==global$1.ResizeObserver?global$1.ResizeObserver:ResizeObserver;function _extends(){return _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var NULL_VIEW_POINT=Object.freeze({x:0,y:0,untransformedX:0,untransformedY:0}),NULL_BOUNDS=Object.freeze({canvasWidth:0,canvasHeight:0,left:0,top:0,right:0,bottom:0,viewMin:NULL_VIEW_POINT,viewMax:NULL_VIEW_POINT}),IDENTITY=Object.freeze({a:1,b:0,c:0,d:1,e:0,f:0});var CoordinateSystem=function(){function CoordinateSystem(_ref){var _this=this,scaleExtents=_ref.scaleExtents,documentSize=_ref.documentSize;_defineProperty(this,"_scaleExtents",void 0),_defineProperty(this,"_documentSize",void 0),_defineProperty(this,"_canvas",null),_defineProperty(this,"_view",{scale:1,x:0,y:0}),_defineProperty(this,"_viewChangeListeners",new Set),_defineProperty(this,"setScale",function(scale){_this.setView({scale})}),_defineProperty(this,"clampView",function(_ref2){var scale=_ref2.scale,x=_ref2.x,y=_ref2.y,_this$scaleExtents=_this.scaleExtents,min=_this$scaleExtents.min,max=_this$scaleExtents.max,_this$documentSize=_this.documentSize,width=_this$documentSize.width,height=_this$documentSize.height,_ref3=_this.canvasRect||NULL_BOUNDS,left=_ref3.left,top=_ref3.top,canvasWidth=_ref3.right-left,canvasHeight=_ref3.bottom-top,maxx=canvasWidth/2,minx=-(width*_this._view.scale-canvasWidth/2),maxy=canvasHeight/2,miny=-(height*_this._view.scale-canvasHeight/2);return{scale:Math.min(Math.max(scale,min),max),x:Math.min(Math.max(x,minx),maxx),y:Math.min(Math.max(y,miny),maxy)}}),_defineProperty(this,"resetView",function(){_this.setView({scale:1,x:0,y:0})}),_defineProperty(this,"setView",function(view){var newView=_this.clampView(_extends({},_this._view,view||{})),_this$_view=_this._view,scale=_this$_view.scale,x=_this$_view.x,y=_this$_view.y;return newView.scale===scale&&newView.x===x&&newView.y===y||(_this._view=newView,_this._viewChangeListeners.forEach(function(listener){return listener&&listener(newView)})),_extends({},_this._view)}),_defineProperty(this,"scaleAtClientPoint",function(deltaScale,clientPoint){var viewPt=_this.clientPointToViewPoint(clientPoint),newView=_this.clampView(_extends({},_this._view,{scale:_this._view.scale+deltaScale})),clientPtPostScale=_this.viewPointToClientPoint(viewPt,newView);return newView.x=_this._view.x-(clientPtPostScale.clientX-clientPoint.clientX),newView.y=_this._view.y-(clientPtPostScale.clientY-clientPoint.clientY),_this.setView(newView)}),_defineProperty(this,"clientPointToViewPoint",function(_ref4,view){var clientX=_ref4.clientX,clientY=_ref4.clientY;void 0===view&&(view=_this._view);var _ref5=_this.canvasRect||NULL_BOUNDS,relativeClientX=clientX-_ref5.left,relativeClientY=clientY-_ref5.top;return{x:(relativeClientX-view.x)/view.scale,y:(relativeClientY-view.y)/view.scale,relativeClientX,relativeClientY}}),_defineProperty(this,"viewPointToClientPoint",function(_ref6,view){var x=_ref6.x,y=_ref6.y;void 0===view&&(view=_this._view);var _ref7=_this.canvasRect||NULL_BOUNDS,left=_ref7.left,top=_ref7.top,relativeX=x*view.scale+view.x,relativeY=y*view.scale+view.y,clientX=relativeX+left,clientY=relativeY+top;return{clientX,clientY,relativeX,relativeY,x:clientX,y:clientY}}),_defineProperty(this,"attachViewChangeListener",function(listener){_this._viewChangeListeners.add(listener)}),this._scaleExtents=scaleExtents,this._documentSize=documentSize}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(CoordinateSystem,[{key:"canvas",get:function get(){return this._canvas},set:function set(canvas){this._canvas=canvas,this.setView()}},{key:"scale",get:function get(){return this._view.scale}},{key:"x",get:function get(){return this._view.x},set:function set(x){this.setView({x})}},{key:"y",get:function get(){return this._view.y},set:function set(y){this.setView({y})}},{key:"view",get:function get(){return _extends({},this._view)}},{key:"scaleExtents",get:function get(){return _extends({},this._scaleExtents)},set:function set(_ref8){var min=_ref8.min,max=_ref8.max;this._scaleExtents={min,max},this.setView()}},{key:"documentSize",get:function get(){return _extends({},this._documentSize)},set:function set(_ref9){var width=_ref9.width,height=_ref9.height;this._documentSize={width,height},this.setView()}},{key:"transformMatrix",get:function get(){return{a:this._view.scale,b:0,c:0,d:this._view.scale,e:this._view.x,f:this._view.y}}},{key:"canvasBounds",get:function get(){if(this._canvas){var _this$_canvas$getBoun=this._canvas.getBoundingClientRect(),left=_this$_canvas$getBoun.left,top=_this$_canvas$getBoun.top,right=_this$_canvas$getBoun.right,bottom=_this$_canvas$getBoun.bottom;return{viewMin:this.clientPointToViewPoint({clientX:left,clientY:top}),viewMax:this.clientPointToViewPoint({clientX:right,clientY:bottom}),left,top,right,bottom,canvasWidth:this._canvas.width,canvasHeight:this._canvas.height}}}},{key:"canvasRect",get:function get(){return this.canvas?this.canvas.getBoundingClientRect():void 0}}]),CoordinateSystem}();function interactionStateMachine_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var SUPPRESS_SCROLL=function SUPPRESS_SCROLL(e){e.preventDefault()},DefaultState=function DefaultState(){var _this2=this;interactionStateMachine_defineProperty(this,"handleMouseWheel",function(e,canvasDraw){var _canvasDraw$props=canvasDraw.props,disabled=_canvasDraw$props.disabled,enablePanAndZoom=_canvasDraw$props.enablePanAndZoom,mouseZoomFactor=_canvasDraw$props.mouseZoomFactor;return disabled?new DisabledState:(enablePanAndZoom&&e.ctrlKey&&(e.preventDefault(),canvasDraw.coordSystem.scaleAtClientPoint(mouseZoomFactor*e.deltaY,clientPointFromEvent(e))),_this2)}),interactionStateMachine_defineProperty(this,"handleDrawStart",function(e,canvasDraw){return canvasDraw.props.disabled?new DisabledState:e.ctrlKey&&canvasDraw.props.enablePanAndZoom?(new PanState).handleDrawStart(e,canvasDraw):(new WaitForPinchState).handleDrawStart(e,canvasDraw)}),interactionStateMachine_defineProperty(this,"handleDrawMove",function(e,canvasDraw){if(canvasDraw.props.disabled)return new DisabledState;var _viewPointFromEvent=viewPointFromEvent(canvasDraw.coordSystem,e),x=_viewPointFromEvent.x,y=_viewPointFromEvent.y;return canvasDraw.lazy.update({x,y}),_this2}),interactionStateMachine_defineProperty(this,"handleDrawEnd",function(e,canvasDraw){return canvasDraw.props.disabled?new DisabledState:_this2})},DisabledState=function DisabledState(){var _this3=this;interactionStateMachine_defineProperty(this,"handleMouseWheel",function(e,canvasDraw){return canvasDraw.props.disabled?_this3:(new DefaultState).handleMouseWheel(e,canvasDraw)}),interactionStateMachine_defineProperty(this,"handleDrawStart",function(e,canvasDraw){return canvasDraw.props.disabled?_this3:(new DefaultState).handleDrawStart(e,canvasDraw)}),interactionStateMachine_defineProperty(this,"handleDrawMove",function(e,canvasDraw){return canvasDraw.props.disabled?_this3:(new DefaultState).handleDrawMove(e,canvasDraw)}),interactionStateMachine_defineProperty(this,"handleDrawEnd",function(e,canvasDraw){return canvasDraw.props.disabled?_this3:(new DefaultState).handleDrawEnd(e,canvasDraw)})},PanState=function PanState(){var _this4=this;interactionStateMachine_defineProperty(this,"handleMouseWheel",SUPPRESS_SCROLL.bind(this)),interactionStateMachine_defineProperty(this,"handleDrawStart",function(e,canvasDraw){return e.preventDefault(),_this4.dragStart=clientPointFromEvent(e),_this4.panStart={x:canvasDraw.coordSystem.x,y:canvasDraw.coordSystem.y},_this4}),interactionStateMachine_defineProperty(this,"handleDrawMove",function(e,canvasDraw){e.preventDefault();var _clientPointFromEvent=clientPointFromEvent(e),clientX=_clientPointFromEvent.clientX,clientY=_clientPointFromEvent.clientY,dx=clientX-_this4.dragStart.clientX,dy=clientY-_this4.dragStart.clientY;return canvasDraw.coordSystem.setView({x:_this4.panStart.x+dx,y:_this4.panStart.y+dy}),_this4}),interactionStateMachine_defineProperty(this,"handleDrawEnd",function(){return new DefaultState})},WaitForPinchState=function WaitForPinchState(){var _this5=this;interactionStateMachine_defineProperty(this,"handleMouseWheel",SUPPRESS_SCROLL.bind(this)),interactionStateMachine_defineProperty(this,"handleDrawStart",function(e,canvasDraw){var enablePanAndZoom=canvasDraw.props.enablePanAndZoom;return e.preventDefault(),e.touches&&e.touches.length&&enablePanAndZoom?enablePanAndZoom&&e.touches&&e.touches.length>=2?(new ScaleOrPanState).handleDrawStart(e,canvasDraw):_this5.handleDrawMove(e,canvasDraw):(new DrawingState).handleDrawStart(e,canvasDraw)}),interactionStateMachine_defineProperty(this,"handleDrawMove",function(e,canvasDraw){if(e.preventDefault(),e.touches&&e.touches.length>=2)return(new ScaleOrPanState).handleDrawStart(e,canvasDraw);var clientPt=clientPointFromEvent(e);if((_this5.deferredPoints.push(clientPt),(new Date).valueOf()-_this5.startTimestamp<250)&&(null===_this5.startClientPoint&&(_this5.startClientPoint=clientPt),Math.abs(clientPt.clientX-_this5.startClientPoint.clientX)+Math.abs(clientPt.clientY-_this5.startClientPoint.clientY)<10))return _this5;return _this5.issueDeferredPoints(canvasDraw)}),interactionStateMachine_defineProperty(this,"handleDrawEnd",function(e,canvasDraw){return _this5.issueDeferredPoints(canvasDraw).handleDrawEnd(e,canvasDraw)}),interactionStateMachine_defineProperty(this,"issueDeferredPoints",function(canvasDraw){for(var nextState=new DrawingState,i=0;i<_this5.deferredPoints.length;i++){var deferredPt=_this5.deferredPoints[i],syntheticEvt=new SyntheticEvent(deferredPt);nextState=(0===i?nextState.handleDrawStart:nextState.handleDrawMove)(syntheticEvt,canvasDraw)}return nextState}),this.startClientPoint=null,this.startTimestamp=(new Date).valueOf(),this.deferredPoints=[]},ScaleOrPanState=function ScaleOrPanState(){var _this6=this;interactionStateMachine_defineProperty(this,"handleMouseWheel",SUPPRESS_SCROLL.bind(this)),interactionStateMachine_defineProperty(this,"handleDrawStart",function(e,canvasDraw){return e.preventDefault(),!e.touches||e.touches.length<2?new DefaultState:(_this6.start=_this6.getTouchMetrics(e),_this6.panStart={x:canvasDraw.coordSystem.x,y:canvasDraw.coordSystem.y},_this6.scaleStart=canvasDraw.coordSystem.scale,_this6)}),interactionStateMachine_defineProperty(this,"handleDrawMove",function(e,canvasDraw){if(e.preventDefault(),!e.touches||e.touches.length<2)return new DefaultState;var _this6$recentMetrics=_this6.recentMetrics=_this6.getTouchMetrics(e),centroid=_this6$recentMetrics.centroid,distance=_this6$recentMetrics.distance;if(Math.abs(distance-_this6.start.distance)>=10)return new TouchScaleState(_this6).handleDrawMove(e,canvasDraw);var dx=centroid.clientX-_this6.start.centroid.clientX,dy=centroid.clientY-_this6.start.centroid.clientY;return Math.abs(dx)+Math.abs(dy)>=10?new TouchPanState(_this6).handleDrawMove(e,canvasDraw):_this6}),interactionStateMachine_defineProperty(this,"handleDrawEnd",function(){return new DefaultState}),interactionStateMachine_defineProperty(this,"getTouchMetrics",function(e){var _clientPointFromEvent2=clientPointFromEvent(e.touches[0]),t1x=_clientPointFromEvent2.clientX,t1y=_clientPointFromEvent2.clientY,_clientPointFromEvent3=clientPointFromEvent(e.touches[1]),t2x=_clientPointFromEvent3.clientX,t2y=_clientPointFromEvent3.clientY,dx=t2x-t1x,dy=t2y-t1y;return{t1:{clientX:t1x,clientY:t1y},t2:{clientX:t2x,clientY:t2y},distance:Math.sqrt(dx*dx+dy*dy),centroid:{clientX:(t1x+t2x)/2,clientY:(t1y+t2y)/2}}})},TouchPanState=function TouchPanState(scaleOrPanState){var _this7=this;interactionStateMachine_defineProperty(this,"handleMouseWheel",SUPPRESS_SCROLL.bind(this)),interactionStateMachine_defineProperty(this,"handleDrawStart",function(){return _this7}),interactionStateMachine_defineProperty(this,"handleDrawMove",function(e,canvasDraw){if(e.preventDefault(),!e.touches||e.touches.length<2)return new DefaultState;var ref=_this7.scaleOrPanState,_ref$recentMetrics=ref.recentMetrics=ref.getTouchMetrics(e),centroid=_ref$recentMetrics.centroid,dx=(_ref$recentMetrics.distance,centroid.clientX-ref.start.centroid.clientX),dy=centroid.clientY-ref.start.centroid.clientY;return canvasDraw.setView({x:ref.panStart.x+dx,y:ref.panStart.y+dy}),_this7}),interactionStateMachine_defineProperty(this,"handleDrawEnd",function(){return new DefaultState}),this.scaleOrPanState=scaleOrPanState},TouchScaleState=function TouchScaleState(scaleOrPanState){var _this8=this;interactionStateMachine_defineProperty(this,"handleMouseWheel",SUPPRESS_SCROLL.bind(this)),interactionStateMachine_defineProperty(this,"handleDrawStart",function(){return _this8}),interactionStateMachine_defineProperty(this,"handleDrawMove",function(e,canvasDraw){if(e.preventDefault(),!e.touches||e.touches.length<2)return new DefaultState;var ref=_this8.scaleOrPanState,_ref$recentMetrics2=ref.recentMetrics=ref.getTouchMetrics(e),centroid=_ref$recentMetrics2.centroid,distance=_ref$recentMetrics2.distance,dScale=ref.scaleStart*(distance/ref.start.distance)-canvasDraw.coordSystem.scale;return canvasDraw.coordSystem.scaleAtClientPoint(dScale,centroid),_this8}),interactionStateMachine_defineProperty(this,"handleDrawEnd",function(){return new DefaultState}),this.scaleOrPanState=scaleOrPanState},DrawingState=function DrawingState(){var _this9=this;interactionStateMachine_defineProperty(this,"handleMouseWheel",SUPPRESS_SCROLL.bind(this)),interactionStateMachine_defineProperty(this,"handleDrawStart",function(e,canvasDraw){if(e.preventDefault(),e.touches&&e.touches.length){var _viewPointFromEvent2=viewPointFromEvent(canvasDraw.coordSystem,e),x=_viewPointFromEvent2.x,y=_viewPointFromEvent2.y;canvasDraw.lazy.update({x,y},{both:!0})}return _this9.handleDrawMove(e,canvasDraw)}),interactionStateMachine_defineProperty(this,"handleDrawMove",function(e,canvasDraw){e.preventDefault();var _viewPointFromEvent3=viewPointFromEvent(canvasDraw.coordSystem,e),x=_viewPointFromEvent3.x,y=_viewPointFromEvent3.y;canvasDraw.lazy.update({x,y});var isDisabled=!canvasDraw.lazy.isEnabled();return _this9.isDrawing&&!isDisabled||(canvasDraw.points.push(canvasDraw.clampPointToDocument(canvasDraw.lazy.brush.toObject())),_this9.isDrawing=!0),canvasDraw.points.push(canvasDraw.clampPointToDocument(canvasDraw.lazy.brush.toObject())),canvasDraw.drawPoints({points:canvasDraw.points,brushColor:canvasDraw.props.brushColor,brushRadius:canvasDraw.props.brushRadius}),_this9}),interactionStateMachine_defineProperty(this,"handleDrawEnd",function(e,canvasDraw){return e.preventDefault(),_this9.handleDrawMove(e,canvasDraw),canvasDraw.saveLine(),new DefaultState}),this.isDrawing=!1},SyntheticEvent=function SyntheticEvent(_ref){var clientX=_ref.clientX,clientY=_ref.clientY;interactionStateMachine_defineProperty(this,"preventDefault",function(){}),this.clientX=clientX,this.clientY=clientY,this.touches=[{clientX,clientY}]};function clientPointFromEvent(e){var clientX=e.clientX,clientY=e.clientY;return e.changedTouches&&e.changedTouches.length>0&&(clientX=e.changedTouches[0].clientX,clientY=e.changedTouches[0].clientY),{clientX,clientY}}function viewPointFromEvent(coordSystem,e){return coordSystem.clientPointToViewPoint(clientPointFromEvent(e))}var passiveSupported=!1;try{var options={get passive(){return passiveSupported=!0,!1}};window.addEventListener("test",options,options),window.removeEventListener("test",options,options)}catch(e){passiveSupported=!1}function _createForOfIteratorHelperLoose(o,allowArrayLike){var it;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(it=o[Symbol.iterator]()).next.bind(it)}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function es_extends(){return es_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},es_extends.apply(this,arguments)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function es_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function midPointBtw(p1,p2){return{x:p1.x+(p2.x-p1.x)/2,y:p1.y+(p2.y-p1.y)/2}}var canvasStyle={display:"block",position:"absolute"},canvasTypes=["grid","drawing","temp","interface"],CanvasDraw=function(_PureComponent){function CanvasDraw(props){var _this;return es_defineProperty(_assertThisInitialized(_this=_PureComponent.call(this,props)||this),"undo",function(){var lines=[];_this.lines.length?lines=_this.lines.slice(0,-1):_this.erasedLines.length&&(lines=_this.erasedLines.pop()),_this.clearExceptErasedLines(),_this.simulateDrawingLines({lines,immediate:!0}),_this.triggerOnChange()}),es_defineProperty(_assertThisInitialized(_this),"eraseAll",function(){_this.erasedLines.push([].concat(_this.lines)),_this.clearExceptErasedLines(),_this.triggerOnChange()}),es_defineProperty(_assertThisInitialized(_this),"clear",function(){_this.erasedLines=[],_this.clearExceptErasedLines(),_this.resetView()}),es_defineProperty(_assertThisInitialized(_this),"resetView",function(){return _this.coordSystem.resetView()}),es_defineProperty(_assertThisInitialized(_this),"setView",function(view){return _this.coordSystem.setView(view)}),es_defineProperty(_assertThisInitialized(_this),"getSaveData",function(){return JSON.stringify({lines:_this.lines,width:_this.props.canvasWidth,height:_this.props.canvasHeight})}),es_defineProperty(_assertThisInitialized(_this),"getDataURL",function(fileType,useBgImage,backgroundColour){var canvasToExport=_this.canvas.drawing,context=canvasToExport.getContext("2d"),width=canvasToExport.width,height=canvasToExport.height,storedImageData=context.getImageData(0,0,width,height),compositeOperation=context.globalCompositeOperation;if(context.globalCompositeOperation="destination-over",useBgImage){if(!_this.props.imgSrc)return"Background image source not set";_this.drawImage()}else null!=backgroundColour&&(context.fillStyle=backgroundColour,context.fillRect(0,0,width,height));fileType||(fileType="png");var imageData=canvasToExport.toDataURL("image/"+fileType);return context.clearRect(0,0,width,height),context.putImageData(storedImageData,0,0),context.globalCompositeOperation=compositeOperation,imageData}),es_defineProperty(_assertThisInitialized(_this),"loadSaveData",function(saveData,immediate){if(void 0===immediate&&(immediate=_this.props.immediateLoading),"string"!=typeof saveData)throw new Error("saveData needs to be of type string!");var _JSON$parse=JSON.parse(saveData),lines=_JSON$parse.lines,width=_JSON$parse.width,height=_JSON$parse.height;if(!lines||"function"!=typeof lines.push)throw new Error("saveData.lines needs to be an array!");if(_this.clear(),width===_this.props.canvasWidth&&height===_this.props.canvasHeight)_this.simulateDrawingLines({lines,immediate});else{var scaleX=_this.props.canvasWidth/width,scaleY=_this.props.canvasHeight/height,scaleAvg=(scaleX+scaleY)/2;_this.simulateDrawingLines({lines:lines.map(function(line){return es_extends({},line,{points:line.points.map(function(p){return{x:p.x*scaleX,y:p.y*scaleY}}),brushRadius:line.brushRadius*scaleAvg})}),immediate})}}),es_defineProperty(_assertThisInitialized(_this),"componentWillUnmount",function(){_this.canvasObserver.unobserve(_this.canvasContainer),_this.canvas.interface&&_this.canvas.interface.removeEventListener("wheel",_this.handleWheel)}),es_defineProperty(_assertThisInitialized(_this),"handleWheel",function(e){_this.interactionSM=_this.interactionSM.handleMouseWheel(e,_assertThisInitialized(_this))}),es_defineProperty(_assertThisInitialized(_this),"handleDrawStart",function(e){_this.interactionSM=_this.interactionSM.handleDrawStart(e,_assertThisInitialized(_this)),_this.mouseHasMoved=!0}),es_defineProperty(_assertThisInitialized(_this),"handleDrawMove",function(e){_this.interactionSM=_this.interactionSM.handleDrawMove(e,_assertThisInitialized(_this)),_this.mouseHasMoved=!0}),es_defineProperty(_assertThisInitialized(_this),"handleDrawEnd",function(e){_this.interactionSM=_this.interactionSM.handleDrawEnd(e,_assertThisInitialized(_this)),_this.mouseHasMoved=!0}),es_defineProperty(_assertThisInitialized(_this),"applyView",function(){if(_this.ctx.drawing&&(canvasTypes.map(function(name){return _this.ctx[name]}).forEach(function(ctx){_this.clearWindow(ctx);var m=_this.coordSystem.transformMatrix;ctx.setTransform(m.a,m.b,m.c,m.d,m.e,m.f)}),!_this.deferRedrawOnViewChange)){_this.drawGrid(_this.ctx.grid),_this.redrawImage(),_this.loop({once:!0});var lines=_this.lines;_this.lines=[],_this.simulateDrawingLines({lines,immediate:!0})}}),es_defineProperty(_assertThisInitialized(_this),"handleCanvasResize",function(entries){var saveData=_this.getSaveData();_this.deferRedrawOnViewChange=!0;try{for(var _step,_iterator=_createForOfIteratorHelperLoose(entries);!(_step=_iterator()).done;){var _entry$contentRect=_step.value.contentRect,width=_entry$contentRect.width,height=_entry$contentRect.height;_this.setCanvasSize(_this.canvas.interface,width,height),_this.setCanvasSize(_this.canvas.drawing,width,height),_this.setCanvasSize(_this.canvas.temp,width,height),_this.setCanvasSize(_this.canvas.grid,width,height),_this.coordSystem.documentSize={width,height},_this.drawGrid(_this.ctx.grid),_this.drawImage(),_this.loop({once:!0})}_this.loadSaveData(saveData,!0)}finally{_this.deferRedrawOnViewChange=!1}}),es_defineProperty(_assertThisInitialized(_this),"clampPointToDocument",function(point){return _this.props.clampLinesToDocument?{x:Math.max(Math.min(point.x,_this.props.canvasWidth),0),y:Math.max(Math.min(point.y,_this.props.canvasHeight),0)}:point}),es_defineProperty(_assertThisInitialized(_this),"redrawImage",function(){_this.image&&_this.image.complete&&function drawImageProp(_temp){var _ref=void 0===_temp?{}:_temp,ctx=_ref.ctx,img=_ref.img,x=_ref.x,y=_ref.y,w=_ref.w,h=_ref.h,offsetX=_ref.offsetX,offsetY=_ref.offsetY;"number"!=typeof x&&(x=0),"number"!=typeof y&&(y=0),"number"!=typeof w&&(w=ctx.canvas.width),"number"!=typeof h&&(h=ctx.canvas.height),"number"!=typeof offsetX&&(offsetX=.5),"number"!=typeof offsetY&&(offsetY=.5),offsetX<0&&(offsetX=0),offsetY<0&&(offsetY=0),offsetX>1&&(offsetX=1),offsetY>1&&(offsetY=1);var cx,cy,cw,ch,iw=img.width,ih=img.height,r=Math.min(w/iw,h/ih),nw=iw*r,nh=ih*r,ar=1;nw<w&&(ar=w/nw),Math.abs(ar-1)<1e-14&&nh<h&&(ar=h/nh),(cx=(iw-(cw=iw/((nw*=ar)/w)))*offsetX)<0&&(cx=0),(cy=(ih-(ch=ih/((nh*=ar)/h)))*offsetY)<0&&(cy=0),cw>iw&&(cw=iw),ch>ih&&(ch=ih),ctx.drawImage(img,cx,cy,cw,ch,x,y,w,h)}({ctx:_this.ctx.grid,img:_this.image})}),es_defineProperty(_assertThisInitialized(_this),"simulateDrawingLines",function(_ref){var lines=_ref.lines,immediate=_ref.immediate,curTime=0,timeoutGap=immediate?0:_this.props.loadTimeOffset;lines.forEach(function(line){var points=line.points,brushColor=line.brushColor,brushRadius=line.brushRadius;if(immediate)return _this.drawPoints({points,brushColor,brushRadius}),_this.points=points,void _this.saveLine({brushColor,brushRadius});for(var _loop=function _loop(i){curTime+=timeoutGap,window.setTimeout(function(){_this.drawPoints({points:points.slice(0,i+1),brushColor,brushRadius})},curTime)},i=1;i<points.length;i++)_loop(i);curTime+=timeoutGap,window.setTimeout(function(){_this.points=points,_this.saveLine({brushColor,brushRadius})},curTime)})}),es_defineProperty(_assertThisInitialized(_this),"setCanvasSize",function(canvas,width,height){canvas.width=width,canvas.height=height,canvas.style.width=width,canvas.style.height=height}),es_defineProperty(_assertThisInitialized(_this),"drawPoints",function(_ref2){var points=_ref2.points,brushColor=_ref2.brushColor,brushRadius=_ref2.brushRadius;_this.ctx.temp.lineJoin="round",_this.ctx.temp.lineCap="round",_this.ctx.temp.strokeStyle=brushColor,_this.clearWindow(_this.ctx.temp),_this.ctx.temp.lineWidth=2*brushRadius;var p1=points[0],p2=points[1];_this.ctx.temp.moveTo(p2.x,p2.y),_this.ctx.temp.beginPath();for(var i=1,len=points.length;i<len;i++){var midPoint=midPointBtw(p1,p2);_this.ctx.temp.quadraticCurveTo(p1.x,p1.y,midPoint.x,midPoint.y),p1=points[i],p2=points[i+1]}_this.ctx.temp.lineTo(p1.x,p1.y),_this.ctx.temp.stroke()}),es_defineProperty(_assertThisInitialized(_this),"saveLine",function(_temp){var _ref3=void 0===_temp?{}:_temp,brushColor=_ref3.brushColor,brushRadius=_ref3.brushRadius;_this.points.length<2||(_this.lines.push({points:[].concat(_this.points),brushColor:brushColor||_this.props.brushColor,brushRadius:brushRadius||_this.props.brushRadius}),_this.points.length=0,_this.inClientSpace([_this.ctx.drawing,_this.ctx.temp],function(){_this.ctx.drawing.drawImage(_this.canvas.temp,0,0,_this.canvas.drawing.width,_this.canvas.drawing.height)}),_this.clearWindow(_this.ctx.temp),_this.triggerOnChange())}),es_defineProperty(_assertThisInitialized(_this),"triggerOnChange",function(){_this.props.onChange&&_this.props.onChange(_assertThisInitialized(_this))}),es_defineProperty(_assertThisInitialized(_this),"clearWindow",function(ctx){_this.inClientSpace([ctx],function(){return ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height)})}),es_defineProperty(_assertThisInitialized(_this),"clearExceptErasedLines",function(){_this.lines=[],_this.valuesChanged=!0,_this.clearWindow(_this.ctx.drawing),_this.clearWindow(_this.ctx.temp)}),es_defineProperty(_assertThisInitialized(_this),"loop",function(_temp2){var _ref4$once=(void 0===_temp2?{}:_temp2).once,once=void 0!==_ref4$once&&_ref4$once;if(_this.mouseHasMoved||_this.valuesChanged){var pointer=_this.lazy.getPointerCoordinates(),brush=_this.lazy.getBrushCoordinates();_this.drawInterface(_this.ctx.interface,pointer,brush),_this.mouseHasMoved=!1,_this.valuesChanged=!1}once||window.requestAnimationFrame(function(){_this.loop()})}),es_defineProperty(_assertThisInitialized(_this),"inClientSpace",function(ctxs,action){ctxs.forEach(function(ctx){ctx.save(),ctx.setTransform(IDENTITY.a,IDENTITY.b,IDENTITY.c,IDENTITY.d,IDENTITY.e,IDENTITY.f)});try{action()}finally{ctxs.forEach(function(ctx){return ctx.restore()})}}),es_defineProperty(_assertThisInitialized(_this),"drawImage",function(){_this.props.imgSrc&&(_this.image=new Image,_this.image.crossOrigin="anonymous",_this.image.onload=_this.redrawImage,_this.image.src=_this.props.imgSrc)}),es_defineProperty(_assertThisInitialized(_this),"drawGrid",function(ctx){if(!_this.props.hideGrid){_this.clearWindow(ctx);var _this$coordSystem$can=_this.coordSystem.canvasBounds,viewMin=_this$coordSystem$can.viewMin,viewMax=_this$coordSystem$can.viewMax,minx=25*Math.floor(viewMin.x/25-1),miny=25*Math.floor(viewMin.y/25-1),maxx=viewMax.x+25,maxy=viewMax.y+25;if(ctx.beginPath(),ctx.setLineDash([5,1]),ctx.setLineDash([]),ctx.strokeStyle=_this.props.gridColor,ctx.lineWidth=_this.props.gridLineWidth,!_this.props.hideGridX){for(var countX=minx,gridSizeX=_this.props.gridSizeX;countX<maxx;)countX+=gridSizeX,ctx.moveTo(countX,miny),ctx.lineTo(countX,maxy);ctx.stroke()}if(!_this.props.hideGridY){for(var countY=miny,gridSizeY=_this.props.gridSizeY;countY<maxy;)countY+=gridSizeY,ctx.moveTo(minx,countY),ctx.lineTo(maxx,countY);ctx.stroke()}}}),es_defineProperty(_assertThisInitialized(_this),"drawInterface",function(ctx,pointer,brush){_this.props.hideInterface||(_this.clearWindow(ctx),ctx.beginPath(),ctx.fillStyle=_this.props.brushColor,ctx.arc(brush.x,brush.y,_this.props.brushRadius,0,2*Math.PI,!0),ctx.fill(),ctx.beginPath(),ctx.fillStyle=_this.props.catenaryColor,ctx.arc(pointer.x,pointer.y,4,0,2*Math.PI,!0),ctx.fill(),_this.lazy.isEnabled()&&(ctx.beginPath(),ctx.lineWidth=2,ctx.lineCap="round",ctx.setLineDash([2,4]),ctx.strokeStyle=_this.props.catenaryColor,_this.catenary.drawToCanvas(_this.ctx.interface,brush,pointer,_this.chainLength),ctx.stroke()),ctx.beginPath(),ctx.fillStyle=_this.props.catenaryColor,ctx.arc(brush.x,brush.y,2,0,2*Math.PI,!0),ctx.fill())}),_this.canvas={},_this.ctx={},_this.catenary=new catenary_curve_lib.Op,_this.points=[],_this.lines=[],_this.erasedLines=[],_this.mouseHasMoved=!0,_this.valuesChanged=!0,_this.isDrawing=!1,_this.isPressing=!1,_this.deferRedrawOnViewChange=!1,_this.interactionSM=new DefaultState,_this.coordSystem=new CoordinateSystem({scaleExtents:props.zoomExtents,documentSize:{width:props.canvasWidth,height:props.canvasHeight}}),_this.coordSystem.attachViewChangeListener(_this.applyView.bind(_assertThisInitialized(_this))),_this}!function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}(CanvasDraw,_PureComponent);var _proto=CanvasDraw.prototype;return _proto.componentDidMount=function componentDidMount(){var _this2=this;this.lazy=new lib.xi({radius:this.props.lazyRadius*window.devicePixelRatio,enabled:!0,initialPoint:{x:window.innerWidth/2,y:window.innerHeight/2}}),this.chainLength=this.props.lazyRadius*window.devicePixelRatio,this.canvasObserver=new ResizeObserver_es(function(entries,observer){return _this2.handleCanvasResize(entries,observer)}),this.canvasObserver.observe(this.canvasContainer),this.drawImage(),this.loop(),window.setTimeout(function(){var initX=window.innerWidth/2,initY=window.innerHeight/2;_this2.lazy.update({x:initX-_this2.chainLength/4,y:initY},{both:!0}),_this2.lazy.update({x:initX+_this2.chainLength/4,y:initY},{both:!1}),_this2.mouseHasMoved=!0,_this2.valuesChanged=!0,_this2.clearExceptErasedLines(),_this2.props.saveData&&_this2.loadSaveData(_this2.props.saveData)},100),this.canvas.interface&&this.canvas.interface.addEventListener("wheel",this.handleWheel,function makePassiveEventOption(passive){return passiveSupported?{passive}:passive}())},_proto.componentDidUpdate=function componentDidUpdate(prevProps){prevProps.lazyRadius!==this.props.lazyRadius&&(this.chainLength=this.props.lazyRadius*window.devicePixelRatio,this.lazy.setRadius(this.props.lazyRadius*window.devicePixelRatio)),prevProps.saveData!==this.props.saveData&&this.loadSaveData(this.props.saveData),JSON.stringify(prevProps)!==JSON.stringify(this.props)&&(this.valuesChanged=!0),this.coordSystem.scaleExtents=this.props.zoomExtents,this.props.enablePanAndZoom||this.coordSystem.resetView(),prevProps.imgSrc!==this.props.imgSrc&&this.drawImage()},_proto.render=function render(){var _this3=this;return react.createElement("div",{className:this.props.className,style:es_extends({display:"block",background:this.props.backgroundColor,touchAction:"none",width:this.props.canvasWidth,height:this.props.canvasHeight},this.props.style),ref:function ref(container){container&&(_this3.canvasContainer=container)}},canvasTypes.map(function(name){var isInterface="interface"===name;return react.createElement("canvas",{key:name,ref:function ref(canvas){canvas&&(_this3.canvas[name]=canvas,_this3.ctx[name]=canvas.getContext("2d"),isInterface&&(_this3.coordSystem.canvas=canvas))},style:es_extends({},canvasStyle),onMouseDown:isInterface?_this3.handleDrawStart:void 0,onMouseMove:isInterface?_this3.handleDrawMove:void 0,onMouseUp:isInterface?_this3.handleDrawEnd:void 0,onMouseOut:isInterface?_this3.handleDrawEnd:void 0,onTouchStart:isInterface?_this3.handleDrawStart:void 0,onTouchMove:isInterface?_this3.handleDrawMove:void 0,onTouchEnd:isInterface?_this3.handleDrawEnd:void 0,onTouchCancel:isInterface?_this3.handleDrawEnd:void 0})}))},CanvasDraw}(react.PureComponent);es_defineProperty(CanvasDraw,"defaultProps",{onChange:null,loadTimeOffset:5,lazyRadius:12,brushRadius:10,brushColor:"#444",catenaryColor:"#0a0302",gridColor:"rgba(150,150,150,0.17)",backgroundColor:"#FFF",hideGrid:!1,canvasWidth:400,canvasHeight:400,disabled:!1,imgSrc:"",saveData:"",immediateLoading:!1,hideInterface:!1,gridSizeX:25,gridSizeY:25,gridLineWidth:.5,hideGridX:!1,hideGridY:!1,enablePanAndZoom:!1,mouseZoomFactor:.01,zoomExtents:{min:.33,max:3},clampLinesToDocument:!1}),CanvasDraw.propTypes={}}}]);